!function(e,t){"use strict";var n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame,a=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.msCancelAnimationFrame,r={};r.bind=function(r,o){function i(){r.removeEventListener("mousedown",c),r.removeEventListener("touchstart",c)}function u(e){for(var t in e)void 0!==e[t]&&(d[t]=e[t])}function c(r){function o(e){if(!(1>x||"touchmove"===e.type&&e.targetTouches[0].target!==E)){m=s(e);var t;f=e,1===x&&(Math.abs(m.x-v.x)>=d.adsorb||Math.abs(m.y-v.y)>=d.adsorb)&&(i(),x=2,t=c("k.dragstart",f),L.dispatchEvent(t)),2===x&&(t=c("k.dragSync",f),L.dispatchEvent(t))}}function i(e){var t,a,r;2===x&&(a=(m.x-h.x)/(e-p||17),r=(m.y-h.y)/(e-p||17),y=Math.abs(a)>=Math.abs(y||0)||Math.abs(a-(y||0))>Math.abs(y||0)?a:.7*y+.3*a,g=Math.abs(r)>=Math.abs(g||0)||Math.abs(r-(g||0))>Math.abs(g||0)?r:.7*g+.3*r,(m.x!==h.x||m.y!==h.y)&&(t=c("k.drag",f),L.dispatchEvent(t)),h=m,p=e),b=n(i)}function u(n){if(a(b),!n||"touchend"!==n.type||n.changedTouches[0].target===E){var r;2===x&&(m=s(n),r=c("k.dragend",n),L.dispatchEvent(r)),x=0,t.removeEventListener("mousemove",o,!0),L.removeEventListener("touchmove",o,!0),t.removeEventListener("mouseup",u,!0),L.removeEventListener("touchend",u,!0),L.removeEventListener("touchcancel",u,!0),e.removeEventListener("blur",u,!0)}}function c(e,n){var a=t.createEvent("Event");return a.initEvent(e,!1,!1),a.pageX=m.x,a.pageY=m.y,a.deltaX=m.x-v.x,a.deltaY=m.y-v.y,a.stepX=m.x-h.x,a.stepY=m.y-h.y,a.vx=y||0,a.vy=g||0,n.type.indexOf("mouse")>-1?a.pointerType="mouse":n.type.indexOf("touch")>-1?(a.pointerType="touch",a.touchId=n.changedTouches[0].identifier):a.pointerType=n.type,a.prevent=function(){x=0,u()},Object.defineProperty(a,"state",{get:function(){return x}}),a.ctrlKey=n.ctrlKey,a.dragTarget=E,a.originalEvent=n,a}var v,m,h,p,f,y,g,E,b,x=0,L=r.currentTarget;r.which&&1!==r.which||(h=m=v=s(r),E=r.target,x=1,t.addEventListener("mousemove",o,!0),L.addEventListener("touchmove",o,!0),t.addEventListener("mouseup",u,!0),L.addEventListener("touchend",u,!0),L.addEventListener("touchcancel",u,!0),e.addEventListener("blur",u,!0))}function s(e){var t,n,a;return e.type.indexOf("touch")>-1?(t="touchmove"===e.type?e.targetTouches[0]:e.changedTouches[0],n=t.pageX,a=t.pageY):(n=e.pageX,a=e.pageY),{x:n,y:a}}var d={adsorb:0};return u(o),r.addEventListener("mousedown",c),r.addEventListener("touchstart",c),{unbind:i,configure:u}},"undefined"!=typeof module&&"object"==typeof exports?module.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):e.kDrag=r}(window,document);