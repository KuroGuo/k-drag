!function(e,t){"use strict";var n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame,a=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.msCancelAnimationFrame,r={};r.bind=function(r,o){function i(){r.removeEventListener("mousedown",u),r.removeEventListener("touchstart",u)}function c(e){for(var t in e)void 0!==e[t]&&(d[t]=e[t])}function u(r){function o(e){if(!(1>g||"touchmove"===e.type&&e.targetTouches[0].target!==b)){m=s(e);var t;y=e,1===g&&(Math.abs(m.x-v.x)>=d.adsorb||Math.abs(m.y-v.y)>=d.adsorb)&&(i(),g=2,t=u("k.dragstart",y),x.dispatchEvent(t)),2===g&&(t=u("k.dragSync",y),x.dispatchEvent(t))}}function i(e){var t,a,r;2===g&&(a=(m.x-h.x)/(e-f||17),r=(m.y-h.y)/(e-f||17),p=Math.abs(a)>=Math.abs(p||0)||Math.abs(a-(p||0))>Math.abs(p||0)?a:.7*p+.3*a,E=Math.abs(r)>=Math.abs(E||0)||Math.abs(r-(E||0))>Math.abs(E||0)?r:.7*E+.3*r,(m.x!==h.x||m.y!==h.y)&&(t=u("k.drag",y),x.dispatchEvent(t)),h=m,f=e),l=n(i)}function c(n){if(a(l),!n||"touchend"!==n.type||n.changedTouches[0].target===b){var r;2===g&&(m=s(n),r=u("k.dragend",n),x.dispatchEvent(r)),g=0,t.removeEventListener("mousemove",o,!0),x.removeEventListener("touchmove",o,!0),t.removeEventListener("mouseup",c,!0),x.removeEventListener("touchend",c,!0),x.removeEventListener("touchcancel",c,!0),e.removeEventListener("blur",c,!0)}}function u(e,n){var a=t.createEvent("Event");return a.initEvent(e,!1,!1),a.clientX=m.x,a.clientY=m.y,a.deltaX=m.x-v.x,a.deltaY=m.y-v.y,a.stepX=m.x-h.x,a.stepY=m.y-h.y,a.vx=p||0,a.vy=E||0,n.type.indexOf("mouse")>-1?a.pointerType="mouse":n.type.indexOf("touch")>-1?(a.pointerType="touch",a.touchId=n.changedTouches[0].identifier):a.pointerType=n.type,a.prevent=function(){g=0,c()},Object.defineProperty(a,"state",{get:function(){return g}}),a.ctrlKey=n.ctrlKey,a.dragTarget=b,a.originalEvent=n,a}var v,m,h,f,y,p,E,b,l,g=0,x=r.currentTarget;r.which&&1!==r.which||(h=m=v=s(r),b=r.target,g=1,t.addEventListener("mousemove",o,!0),x.addEventListener("touchmove",o,!0),t.addEventListener("mouseup",c,!0),x.addEventListener("touchend",c,!0),x.addEventListener("touchcancel",c,!0),e.addEventListener("blur",c,!0))}function s(e){var t,n,a;return e.type.indexOf("touch")>-1?(t="touchmove"===e.type?e.targetTouches[0]:e.changedTouches[0],n=t.clientX,a=t.clientY):(n=e.clientX,a=e.clientY),{x:n,y:a}}var d={adsorb:0};return c(o),r.addEventListener("mousedown",u),r.addEventListener("touchstart",u),{unbind:i,configure:c}},"undefined"!=typeof module&&"object"==typeof exports?module.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):e.kDrag=r}(window,document);